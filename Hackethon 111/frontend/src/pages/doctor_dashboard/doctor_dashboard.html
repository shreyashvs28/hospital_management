<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - St. Seraphina's Hospital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        
         ::-webkit-scrollbar {
            width: 8px;
        }
        
         ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
         ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
         ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Styles for the modal */
        
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>

<body class="bg-gray-100">

    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
    <div class="hidden md:flex flex-col w-64 bg-white shadow-lg z-10">
            <div class="flex items-center justify-center h-20 shadow-md">
                <h1 class="text-2xl font-bold text-blue-600">St. Seraphina's</h1>
            </div>
            <nav class="flex-1 px-2 py-4 space-y-2">
                <a href="doctor_dashboard.html" class="flex items-center px-4 py-2 text-gray-700 bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>                    Dashboard
                </a>
                <a href="#dashboard" data-view="dashboard" class="flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>                    Schedule
                </a>
                <a href="#patients" data-view="patients" class="flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>                    Patients
                </a>
                <a href="#blood" data-src="../Blood/blood.html" class="sidebar-link flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 2.25c-5.18 0-9.42 4.01-9.42 8.94C2.58 16.12 12 22.5 12 22.5s9.42-6.38 9.42-11.31C21.42 6.26 17.18 2.25 12 2.25z"></path>
    </svg> Blood
                </a>
                <a href="#profile" data-view="profile" class="flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>                    Profile
                </a>
                <a href="#lab" data-src="../lab/lab_dashboard.html" class="sidebar-link flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"></path></svg>                    Laboratory
                </a>

                <a href="#ward" data-src="../ward/ward_dashboard.html" class="sidebar-link flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6M9 11.25h6m-6 4.5h6M6.75 21v-2.25a2.25 2.25 0 0 1 2.25-2.25h6a2.25 2.25 0 0 1 2.25 2.25V21M6.75 3v2.25a2.25 2.25 0 0 0 2.25 2.25h6a2.25 2.25 0 0 0 2.25-2.25V3"></path></svg>                    Ward
                </a>

                <a href="#pharmacy" data-src="../farmacy/dashboard.html" class="sidebar-link flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.429 9.75L2.25 12l4.179 2.25m0-4.5l5.571 3 5.571-3m-11.142 0L2.25 12l4.179 2.25m0 0l5.571 3 5.571-3m0 0l4.179-2.25L12 9.75l-5.571 3z"></path></svg>                    Pharmacy
                </a>
                <a href="#emergency" data-src="../emergency/emergency.html" class="sidebar-link flex items-center px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path></svg>                    Emergency
                </a>
                <a href="../auth/login.html" class="flex items-center px-4 py-2 mt-auto text-gray-600 hover:bg-red-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>                    Logout
                </a>
            </nav>
        </div>

        <!-- Main content -->
        <div class="flex flex-col flex-1 overflow-y-auto">
            <div class="flex items-center justify-between h-20 bg-white shadow-md px-6">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-semibold text-gray-800">Doctor's Dashboard</h1>
                    <button id="edit-dashboard-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-md hover:bg-gray-300 transition duration-300 flex items-center text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L15.232 5.232z"></path></svg>
                        Edit Dashboard
                    </button>
                </div>
                <div class="flex items-center">
                    <span class="text-gray-600 mr-4">Welcome, Dr. Anjali Rao!</span>
                    <img class="w-10 h-10 rounded-full object-cover" src="https://placehold.co/100x100/cbd5e0/ffffff?text=A" alt="User Avatar">
                </div>
            </div>

            <div class="p-6">
                <!-- External page iframe for loading Blood/Pharmacy/Emergency content -->
                <div id="external-frame-container" class="mb-6 hidden">
                    <iframe id="external-frame" src="about:blank" class="w-full h-[60vh] bg-white rounded-lg shadow-md border" frameborder="0" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                </div>

                <!-- Internal views: dashboard / profile / patients / schedule -->
                <div id="view-dashboard" class="view-section">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700">Today's Appointments</h3>
                                <p class="text-3xl font-bold text-blue-600" data-metric="appointments">0</p>
                            </div>
                            <svg class="w-12 h-12 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700">Total Patients</h3>
                                <p class="text-3xl font-bold text-green-600" data-metric="patients">0</p>
                            </div>
                            <svg class="w-12 h-12 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700">Open Cases</h3>
                                <p class="text-3xl font-bold text-yellow-600" data-metric="cases">0</p>
                            </div>
                            <svg class="w-12 h-12 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                        </div>
                    </div>

                    <!-- NEW: Inspirational Quotes -->
                    <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">A Thought for the Day</h3>
                        <div class="space-y-4">
                            <blockquote class="border-l-4 border-blue-500 pl-4 italic text-gray-600">
                                <p>"The good physician treats the disease; the great physician treats the patient who has the disease."</p>
                                <cite class="mt-2 block text-right font-semibold not-italic text-gray-500">- William Osler</cite>
                            </blockquote>
                            <blockquote class="border-l-4 border-green-500 pl-4 italic text-gray-600">
                                <p>"Wherever the art of medicine is loved, there is also a love of humanity."</p>
                                <cite class="mt-2 block text-right font-semibold not-italic text-gray-500">- Hippocrates</cite>
                            </blockquote>
                        </div>
                    </div>
                </div>

                <!-- Profile view (merged) -->
                <div id="view-profile" class="view-section hidden">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-6 border-b pb-4">
                            <h2 class="text-xl font-bold text-gray-800">Doctor Information</h2>
                            <button id="edit-profile-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">Edit Profile</button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Professional Information</h3>
                                <div class="space-y-4">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500">Full Name</p>
                                        <p id="display-full-name" class="text-lg text-gray-900"></p>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-500">Degree</p>
                                        <p id="display-degree" class="text-lg text-gray-900"></p>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-500">Speciality</p>
                                        <p id="display-speciality" class="text-lg text-gray-900"></p>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-500">Email Address</p>
                                        <p id="display-email" class="text-lg text-gray-900"></p>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-500">Phone Number</p>
                                        <p id="display-phone" class="text-lg text-gray-900"></p>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-700 mb-4">Biography</h3>
                                <div class="space-y-4">
                                    <div>
                                        <p class="text-sm font-medium text-gray-500">Professional Statement</p>
                                        <p id="display-biography" class="text-base text-gray-800 whitespace-pre-wrap"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p id="status-message" class="mt-6 text-center text-green-600 font-medium hidden">Profile updated successfully!</p>
                    </div>
                </div>

                <!-- Patients view (merged) -->
                <div id="view-patients" class="view-section hidden">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-700 mb-4 md:mb-0">All Assigned Patients</h3>
                            <div class="flex items-center space-x-4 w-full md:w-auto">
                                <input id="search-input" type="text" placeholder="Search by patient name or ID..." class="w-full md:w-64 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button id="create-patient-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300 whitespace-nowrap">Create Patient</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="text-gray-600">
                                        <th class="py-2 px-4 border-b">Patient ID</th>
                                        <th class="py-2 px-4 border-b">Name</th>
                                        <th class="py-2 px-4 border-b">Last Visit</th>
                                        <th class="py-2 px-4 border-b">Diagnosis</th>
                                        <th class="py-2 px-4 border-b">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="patients-tbody">
                                    <!-- Patient rows will be dynamically inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Schedule view (merged) -->
                <div id="view-schedule" class="view-section hidden">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                            <h3 id="schedule-title" class="text-lg font-semibold text-gray-700 mb-4 md:mb-0">Today's Appointments</h3>
                            <div class="flex items-center space-x-4 w-full md:w-auto">
                                <input id="date-picker" type="date" class="border border-gray-300 rounded-md p-2">
                                <button id="add-appointment-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300 whitespace-nowrap">Add Appointment</button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="text-gray-600">
                                        <th class="py-2 px-4 border-b">Time</th>
                                        <th class="py-2 px-4 border-b">Patient Name</th>
                                        <th class="py-2 px-4 border-b">Reason for Visit</th>
                                        <th class="py-2 px-4 border-b">Status</th>
                                        <th class="py-2 px-4 border-b">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="schedule-tbody">
                                    <!-- Schedule rows will be dynamically inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Merged Modals: Profile Edit, Patient Modal, Appointment Modal -->
    <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl p-6 modal-content scale-95 max-h-full overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Edit Profile</h2>
            <form id="profile-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Professional Information</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="full-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="full-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="degree" class="block text-sm font-medium text-gray-700">Degree</label>
                                <input type="text" id="degree" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="speciality" class="block text-sm font-medium text-gray-700">Speciality</label>
                                <input type="text" id="speciality" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                                <input type="tel" id="phone" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700 mb-4">Biography</h3>
                        <div>
                            <label for="biography" class="block text-sm font-medium text-gray-700">Professional Statement</label>
                            <textarea id="biography" rows="10" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                        </div>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t flex justify-end space-x-3">
                    <button type="button" id="profile-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-md hover:bg-blue-700">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <div id="patient-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 modal-content scale-95">
            <h2 id="patient-modal-title" class="text-2xl font-bold text-gray-800 mb-6">Create New Patient</h2>
            <form id="patient-form">
                <div class="space-y-4">
                    <div>
                        <label for="patientId" class="block text-sm font-medium text-gray-700">Patient ID</label>
                        <input type="text" id="patientId" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Patient Name</label>
                        <input type="text" id="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="lastVisit" class="block text-sm font-medium text-gray-700">Last Visit</label>
                        <input type="date" id="lastVisit" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="diagnosis" class="block text-sm font-medium text-gray-700">Diagnosis</label>
                        <input type="text" id="diagnosis" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t flex justify-end space-x-3">
                    <button type="button" id="patient-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300">Cancel</button>
                    <button type="submit" id="patient-save-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700">Save Patient</button>
                </div>
            </form>
        </div>
    </div>

    <div id="appointment-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 modal-content scale-95">
            <h2 id="appointment-modal-title" class="text-2xl font-bold text-gray-800 mb-6">Add New Appointment</h2>
            <form id="appointment-form">
                <input type="hidden" id="appointment-id">
                <div class="space-y-4">
                    <div>
                        <label for="time" class="block text-sm font-medium text-gray-700">Time</label>
                        <input type="time" id="time" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="patientName" class="block text-sm font-medium text-gray-700">Patient Name</label>
                        <input type="text" id="patientName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="reason" class="block text-sm font-medium text-gray-700">Reason for Visit</label>
                        <input type="text" id="reason" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                        <select id="status" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                            <option>Confirmed</option>
                            <option>Pending</option>
                            <option>Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t flex justify-end space-x-3">
                    <button type="button" id="appointment-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md hover:bg-gray-300">Cancel</button>
                    <button type="submit" id="appointment-save-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md hover:bg-green-700">Save Appointment</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Storage key
            const STORAGE_KEY = 'doctor_dashboard_state_v2';

            // Default state
            const defaultState = {
                metrics: { appointments: 12, patients: 256, cases: 5 },
                profile: {
                    fullName: 'Dr. Anjali Rao',
                    degree: 'MBBS, MD (Cardiology)',
                    speciality: 'Cardiology',
                    email: 'anjali.rao@stseraphinas.com',
                    phone: '+91 9876543210',
                    biography: 'Dr. Anjali Rao is a board-certified cardiologist with over 15 years of experience in treating complex heart conditions. She is dedicated to providing compassionate and comprehensive care to all her patients.'
                },
                patients: [
                    { patientId: 'PAT201', name: 'Priya Sharma', lastVisit: '2025-08-15', diagnosis: 'Hypertension' },
                    { patientId: 'PAT202', name: 'Rohan Verma', lastVisit: '2025-07-20', diagnosis: 'Common Cold' },
                    { patientId: 'PAT204', name: 'Amit Kumar', lastVisit: '2025-08-25', diagnosis: 'Post-operative Follow-up' }
                ],
                schedule: {
                    '2025-08-27': [
                        { id: 1, time: '10:00', patientName: 'Rohan Verma', reason: 'Follow-up Checkup', status: 'Confirmed' },
                        { id: 2, time: '10:30', patientName: 'Sunita Patil', reason: 'New Patient Consultation', status: 'Confirmed' },
                        { id: 3, time: '11:00', patientName: 'Priya Sharma', reason: 'Routine Checkup', status: 'Pending' }
                    ]
                }
            };

            // Load/Save state
            function loadState() {
                try {
                    const raw = localStorage.getItem(STORAGE_KEY);
                    if (raw) return JSON.parse(raw);
                } catch (e) { console.warn('Failed to load state', e.message); }
                return JSON.parse(JSON.stringify(defaultState));
            }

            function saveState() {
                try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch (e) { console.warn('Failed to save state', e.message); }
            }

            let state = loadState();

            // --- View switching ---
            const viewSections = document.querySelectorAll('.view-section');
            function showView(name) {
                viewSections.forEach(s => s.classList.add('hidden'));
                const el = document.getElementById('view-' + name);
                if (el) el.classList.remove('hidden');
                // hide external iframe when showing internal views
                if (name !== 'external') document.getElementById('external-frame-container').classList.add('hidden');
                if (name === 'dashboard') renderMetrics();
                if (name === 'profile') renderProfile();
                if (name === 'patients') renderPatientsTable(state.patients);
                if (name === 'schedule') renderSchedule(datePicker.value);
            }

            // Wire sidebar data-view links
            document.querySelectorAll('[data-view]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const view = link.dataset.view;
                    showView(view);
                });
            });

            // Wire sidebar external links (.sidebar-link)
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const src = link.dataset.src;
                    const externalContainer = document.getElementById('external-frame-container');
                    const externalFrame = document.getElementById('external-frame');
                    if (src) {
                        externalFrame.src = src;
                        externalContainer.classList.remove('hidden');
                        viewSections.forEach(s => s.classList.add('hidden'));
                    }
                });
            });

            // --- Metrics ---
            function renderMetrics() {
                document.querySelector('[data-metric="appointments"]').textContent = state.metrics.appointments;
                document.querySelector('[data-metric="patients"]').textContent = state.metrics.patients;
                document.querySelector('[data-metric="cases"]').textContent = state.metrics.cases;
            }

            // --- Profile ---
            const profileCancelBtn = document.getElementById('profile-cancel-btn');
            const profileModal = document.getElementById('profile-modal');
            function renderProfile() {
                const p = state.profile;
                document.getElementById('display-full-name').textContent = p.fullName || 'N/A';
                document.getElementById('display-degree').textContent = p.degree || 'N/A';
                document.getElementById('display-speciality').textContent = p.speciality || 'N/A';
                document.getElementById('display-email').textContent = p.email || 'N/A';
                document.getElementById('display-phone').textContent = p.phone || 'N/A';
                document.getElementById('display-biography').textContent = p.biography || 'N/A';
                const welcome = document.querySelector('.flex.items-center .text-gray-600') || document.getElementById('welcome-text');
                if (welcome) welcome.textContent = `Welcome, ${p.fullName || 'Doctor'}!`;
            }

            document.getElementById('edit-profile-btn').addEventListener('click', () => {
                // populate form
                const p = state.profile;
                document.getElementById('full-name').value = p.fullName;
                document.getElementById('degree').value = p.degree;
                document.getElementById('speciality').value = p.speciality;
                document.getElementById('email').value = p.email;
                document.getElementById('phone').value = p.phone;
                document.getElementById('biography').value = p.biography;
                profileModal.classList.remove('hidden');
            });

            profileCancelBtn.addEventListener('click', () => profileModal.classList.add('hidden'));
            profileModal.addEventListener('click', (e) => { if (e.target === profileModal) profileModal.classList.add('hidden'); });

            document.getElementById('profile-form').addEventListener('submit', (e) => {
                e.preventDefault();
                state.profile.fullName = document.getElementById('full-name').value;
                state.profile.degree = document.getElementById('degree').value;
                state.profile.speciality = document.getElementById('speciality').value;
                state.profile.email = document.getElementById('email').value;
                state.profile.phone = document.getElementById('phone').value;
                state.profile.biography = document.getElementById('biography').value;
                saveState();
                renderProfile();
                profileModal.classList.add('hidden');
            });

            // --- Patients ---
            const patientsTbody = document.getElementById('patients-tbody');
            const searchInput = document.getElementById('search-input');
            let editingPatientId = null;

            function renderPatientsTable(list) {
                patientsTbody.innerHTML = '';
                if (!list || list.length === 0) {
                    patientsTbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500 py-4">No patients found</td></tr>';
                    return;
                }
                list.forEach(p => {
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-50';
                    tr.innerHTML = `\n                    <td class="py-2 px-4 border-b">${p.patientId}</td>\n                    <td class="py-2 px-4 border-b">${p.name}</td>\n                    <td class="py-2 px-4 border-b">${p.lastVisit}</td>\n                    <td class="py-2 px-4 border-b">${p.diagnosis}</td>\n                    <td class="py-2 px-4 border-b space-x-2">\n                        <button class="edit-btn text-blue-500 hover:underline" data-id="${p.patientId}">Edit</button>\n                        <button class="delete-btn text-red-500 hover:underline" data-id="${p.patientId}">Delete</button>\n                    </td>\n                `;
                    patientsTbody.appendChild(tr);
                });
            }

            document.getElementById('create-patient-btn').addEventListener('click', () => {
                editingPatientId = null;
                document.getElementById('patient-form').reset();
                document.getElementById('patientId').disabled = false;
                document.getElementById('patient-modal-title').textContent = 'Create New Patient';
                document.getElementById('patient-save-btn').textContent = 'Save Patient';
                document.getElementById('patient-modal').classList.remove('hidden');
            });

            document.getElementById('patient-cancel-btn').addEventListener('click', () => document.getElementById('patient-modal').classList.add('hidden'));
            document.getElementById('patient-modal').addEventListener('click', (e) => { if (e.target === document.getElementById('patient-modal')) document.getElementById('patient-modal').classList.add('hidden'); });

            patientsTbody.addEventListener('click', (e) => {
                const id = e.target.dataset.id;
                if (!id) return;
                if (e.target.classList.contains('edit-btn')) {
                    const p = state.patients.find(x => x.patientId === id);
                    editingPatientId = id;
                    document.getElementById('patient-form').reset();
                    document.getElementById('patientId').value = p.patientId; document.getElementById('patientId').disabled = true;
                    document.getElementById('name').value = p.name; document.getElementById('lastVisit').value = p.lastVisit; document.getElementById('diagnosis').value = p.diagnosis;
                    document.getElementById('patient-modal-title').textContent = 'Edit Patient Details';
                    document.getElementById('patient-save-btn').textContent = 'Update Patient';
                    document.getElementById('patient-modal').classList.remove('hidden');
                }
                if (e.target.classList.contains('delete-btn')) {
                    if (confirm('Delete patient ' + id + '?')) {
                        state.patients = state.patients.filter(x => x.patientId !== id);
                        saveState();
                        renderPatientsTable(state.patients);
                        state.metrics.patients = state.patients.length;
                        saveState();
                        renderMetrics();
                    }
                }
            });

            document.getElementById('patient-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = {
                    patientId: document.getElementById('patientId').value,
                    name: document.getElementById('name').value,
                    lastVisit: document.getElementById('lastVisit').value,
                    diagnosis: document.getElementById('diagnosis').value
                };
                if (editingPatientId) {
                    const idx = state.patients.findIndex(x => x.patientId === editingPatientId);
                    state.patients[idx] = form;
                } else {
                    if (state.patients.some(x => x.patientId === form.patientId)) { alert('Patient with this ID exists'); return; }
                    state.patients.push(form);
                }
                saveState();
                renderPatientsTable(state.patients);
                state.metrics.patients = state.patients.length; saveState(); renderMetrics();
                document.getElementById('patient-modal').classList.add('hidden');
            });

            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = state.patients.filter(p => p.patientId.toLowerCase().includes(term) || p.name.toLowerCase().includes(term));
                renderPatientsTable(filtered);
            });

            // --- Schedule ---
            const scheduleTbody = document.getElementById('schedule-tbody');
            const datePicker = document.getElementById('date-picker');
            let editingAppointmentId = null;

            function formatDate(d) { return d.toISOString().split('T')[0]; }
            function formatTime(timeString) { const [hour, minute] = timeString.split(':'); const h = parseInt(hour, 10); const ampm = h >= 12 ? 'PM' : 'AM'; const formattedHour = h % 12 || 12; return `${formattedHour}:${minute} ${ampm}`; }

            function getStatusBadge(status) {
                const styles = { 'Confirmed':'bg-green-200 text-green-800','Pending':'bg-yellow-200 text-yellow-800','Cancelled':'bg-red-200 text-red-800' };
                return `<span class="${styles[status] || 'bg-gray-200 text-gray-800'} py-1 px-3 rounded-full text-xs">${status}</span>`;
            }

            function renderSchedule(date) {
                const appointments = state.schedule[date] || [];
                scheduleTbody.innerHTML = '';
                if (!appointments.length) { scheduleTbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500 py-4">No appointments for this day.</td></tr>'; return; }
                appointments.sort((a,b)=>a.time.localeCompare(b.time)).forEach(app=>{
                    const tr = document.createElement('tr'); tr.className='hover:bg-gray-50'; tr.innerHTML = `\n                    <td class="py-2 px-4 border-b">${formatTime(app.time)}</td>\n                    <td class="py-2 px-4 border-b">${app.patientName}</td>\n                    <td class="py-2 px-4 border-b">${app.reason}</td>\n                    <td class="py-2 px-4 border-b">${getStatusBadge(app.status)}</td>\n                    <td class="py-2 px-4 border-b space-x-2">\n                        <button class="edit-apt text-blue-500 hover:underline" data-id="${app.id}">Edit</button>\n                        <button class="delete-apt text-red-500 hover:underline" data-id="${app.id}">Delete</button>\n                    </td>\n                `; scheduleTbody.appendChild(tr);
                });
            }

            document.getElementById('add-appointment-btn').addEventListener('click', ()=>{
                editingAppointmentId = null; document.getElementById('appointment-form').reset(); document.getElementById('appointment-modal').classList.remove('hidden');
            });
            document.getElementById('appointment-cancel-btn').addEventListener('click', ()=>document.getElementById('appointment-modal').classList.add('hidden'));
            document.getElementById('appointment-modal').addEventListener('click', (e)=>{ if (e.target===document.getElementById('appointment-modal')) document.getElementById('appointment-modal').classList.add('hidden'); });

            scheduleTbody.addEventListener('click', (e)=>{
                const id = parseInt(e.target.dataset.id,10); if (!id) return; const selectedDate = datePicker.value; const apps = state.schedule[selectedDate] || [];
                if (e.target.classList.contains('edit-apt')){
                    const app = apps.find(a=>a.id===id); editingAppointmentId = id; document.getElementById('time').value=app.time; document.getElementById('patientName').value=app.patientName; document.getElementById('reason').value=app.reason; document.getElementById('status').value=app.status; document.getElementById('appointment-modal').classList.remove('hidden');
                }
                if (e.target.classList.contains('delete-apt')){
                    if (confirm('Delete appointment?')){ state.schedule[selectedDate] = apps.filter(a=>a.id!==id); saveState(); renderSchedule(selectedDate); }
                }
            });

            document.getElementById('appointment-form').addEventListener('submit', (e)=>{
                e.preventDefault(); const selectedDate = datePicker.value || formatDate(new Date()); if (!state.schedule[selectedDate]) state.schedule[selectedDate]=[]; const apps = state.schedule[selectedDate]; const form = { id: editingAppointmentId || Date.now(), time: document.getElementById('time').value, patientName: document.getElementById('patientName').value, reason: document.getElementById('reason').value, status: document.getElementById('status').value };
                if (editingAppointmentId) { const idx = apps.findIndex(a=>a.id===editingAppointmentId); apps[idx]=form; } else { apps.push(form); }
                saveState(); renderSchedule(selectedDate); document.getElementById('appointment-modal').classList.add('hidden');
            });

            datePicker.addEventListener('change', ()=>{
                const sel = new Date(datePicker.value); const today = new Date(); const formatted = sel.toLocaleDateString('en-US',{ month:'long', day:'numeric', year:'numeric' }); if (datePicker.value === formatDate(today)) document.getElementById('schedule-title').textContent = `Today's Appointments - ${formatted}`; else document.getElementById('schedule-title').textContent = `Appointments for ${formatted}`;
                renderSchedule(datePicker.value);
            });

            // --- Initialization ---
            function initialize() {
                renderMetrics(); renderProfile(); renderPatientsTable(state.patients);
                // init date picker
                const today = new Date(); datePicker.value = formatDate(today); datePicker.dispatchEvent(new Event('change'));
            }

            initialize();
        });
    </script>

</body>

</html>