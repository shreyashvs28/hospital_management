<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ward Dashboard - St. Seraphina's Hospital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    </head>
    <style>
         /* Extracted styles for ward dashboard */
        body { font-family: 'Inter', sans-serif; }

        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-we bkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Styles for the modal */
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }

        /* Bed hover */
        .bed { transition: transform 0.2s; }
        .bed:hover { transform: translateY(-5px); cursor: pointer; }
    </style>
   

<body class="bg-gray-100">

    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar -->
        <div class="hidden md:flex flex-col w-64 bg-white shadow-lg">
            <div class="flex items-center justify-center h-20 shadow-md">
                <h1 class="text-2xl font-bold text-blue-600">St. Seraphina's</h1>
            </div>
            <nav class="flex-1 px-2 py-4 space-y-2">
                <button data-tab="dashboard" class="tab-btn flex items-center w-full px-4 py-2 text-gray-700 bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3"></path></svg> Dashboard
                </button>
                <button data-tab="beds" class="tab-btn flex items-center w-full px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7"></path></svg> Bed Management
                </button>
                <button data-tab="schedule" class="tab-btn flex items-center w-full px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10"></path></svg> Ward Schedule
                </button>
                <button data-tab="overview" class="tab-btn flex items-center w-full px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m7-7l7 7"></path></svg> Ward Overview
                </button>
                <a href="../auth/login.html" class="flex items-center px-4 py-2 mt-auto text-gray-600 hover:bg-red-200 rounded-md">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4"></path></svg> Logout
                </a>
            </nav>
        </div>

        <!-- Main content -->

        <div class="flex flex-col flex-1 overflow-y-auto">
            <div class="flex items-center justify-between h-20 bg-white shadow-md px-6">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-semibold text-gray-800">Ward Dashboard</h1>
                    <button id="dash-edit-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-md hover:bg-gray-300 transition duration-300 flex items-center text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536"></path></svg> Edit Dashboard
                    </button>
                </div>
                <span class="text-gray-600">Welcome, Ward Supervisor!</span>
            </div>

            <div class="p-6">
                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700">Total Beds</h3>
                        <p class="text-3xl font-bold text-blue-600" data-metric="total">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700">Occupied</h3>
                        <p class="text-3xl font-bold text-red-600" data-metric="occupied">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700">Available</h3>
                        <p class="text-3xl font-bold text-green-600" data-metric="available">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700">Occupancy Rate</h3>
                        <p class="text-3xl font-bold text-purple-600" data-metric="rate">0%</p>
                    </div>
                </div>

                <!-- Ward Overview -->
                <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Ward Occupancy Overview</h3>
                    <div id="ward-overview-container" class="space-y-4">
                        <!-- Ward progress bars will be rendered here -->
                    </div>
                </div>

                <!-- Tabs content -->
                <div class="mt-8">
                    <div class="flex space-x-2 mb-4">
                        <button data-tab="dashboard" class="tab-btn px-4 py-2 bg-blue-600 text-white rounded-md">Dashboard</button>
                        <button data-tab="beds" class="tab-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Beds</button>
                        <button data-tab="schedule" class="tab-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Schedule</button>
                        <button data-tab="overview" class="tab-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-md">Overview</button>
                    </div>

                    <!-- Dashboard (main) section - already present above -->
                    <div id="section-dashboard" class="tab-section">
                        <!-- keep existing metrics & overview visible -->
                    </div>


                    <!-- Beds Section -->
                    <div id="section-beds" class="tab-section hidden">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex items-center justify-between mb-4">
                                <h1 class="text-2xl font-semibold">Bed Management</h1>
                                <div class="flex items-center space-x-4">
                                    <button id="beds-edit-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700">Edit Beds</button>
                                    <span class="text-gray-600">Manage beds and patients</span>
                                </div>
                            </div>
                            <div id="beds-wards-container" class="space-y-8">
                                <!-- Beds content rendered here -->
                            </div>
                            <div class="mt-8 bg-white p-4 rounded-lg shadow-md flex items-center justify-center space-x-6">
                                <div class="flex items-center"><div class="w-4 h-4 bg-green-500 rounded-sm mr-2"></div><span>Available</span></div>
                                <div class="flex items-center"><div class="w-4 h-4 bg-red-500 rounded-sm mr-2"></div><span>Occupied</span></div>
                                <div class="flex items-center"><div class="w-4 h-4 bg-yellow-400 rounded-sm mr-2"></div><span>Needs Cleaning</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule Section -->
                    <div id="section-schedule" class="tab-section hidden">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                                <h3 id="sched-title" class="text-lg font-semibold text-gray-700 mb-4 md:mb-0">Staff Schedule</h3>
                                <div class="flex items-center space-x-4 w-full md:w-auto">
                                    <input id="sched-date-picker" type="date" class="border border-gray-300 rounded-md p-2">
                                    <button id="sched-add-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700">Add Schedule</button>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead>
                                        <tr class="text-gray-600">
                                            <th class="py-2 px-4 border-b">Staff Name</th>
                                            <th class="py-2 px-4 border-b">Role</th>
                                            <th class="py-2 px-4 border-b">Ward</th>
                                            <th class="py-2 px-4 border-b">Shift</th>
                                            <th class="py-2 px-4 border-b">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sched-table-body">
                                        <!-- Schedule rows -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Ward Overview Section (full) -->
                    <div id="section-overview" class="tab-section hidden">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">Ward & Bed Overview</h3>
                            <div id="overview-content">
                                <!-- static sample layout from original ward.html -->
                                <div class="space-y-8">
                                    <div class="bg-white p-6 rounded-lg shadow-md">
                                        <h3 class="text-xl font-semibold text-gray-800 mb-4">General Ward</h3>
                                        <div id="overview-general" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-4"></div>
                                    </div>
                                    <div class="bg-white p-6 rounded-lg shadow-md">
                                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Intensive Care Unit (ICU)</h3>
                                        <div id="overview-icu" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-4"></div>
                                    </div>
                                    <div class="bg-white p-6 rounded-lg shadow-md">
                                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Maternity Ward</h3>
                                        <div id="overview-mat" class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-4"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Modals: Dashboard edit -->
    <div id="dash-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl p-6 modal-content scale-95 max-h-full overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Edit Ward Data</h2>
            <form id="dash-edit-form">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h3 class="text-lg font-semibold text-gray-700">Wards</h3>
                    <button type="button" id="dash-add-ward-btn" class="bg-blue-600 text-white font-bold py-1 px-3 rounded-md text-sm">Add Ward</button>
                </div>
                <div id="dash-wards-editor" class="space-y-2"></div>
                <div class="mt-8 pt-6 border-t flex justify-end space-x-3">
                    <button type="button" id="dash-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md">Cancel</button>
                    <button type="submit" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modals: Beds edit -->
    <div id="beds-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl p-6 modal-content scale-95 max-h-full overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Edit Bed Assignments</h2>
            <form id="beds-edit-form">
                <div id="beds-wards-editor" class="space-y-6"></div>
                <div class="mt-8 pt-6 border-t flex justify-end space-x-3">
                    <button type="button" id="beds-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md">Cancel</button>
                    <button type="submit" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Patient Info Modal -->
    <div id="beds-patient-info-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 modal-content scale-95">
            <div class="flex justify-between items-center mb-4">
                <h2 id="beds-patient-modal-title" class="text-2xl font-bold text-gray-800">Patient Information</h2>
                <button id="beds-patient-modal-close-btn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="beds-patient-info-content" class="space-y-4"></div>
        </div>
    </div>

    <!-- Patient Edit Modal -->
    <div id="beds-patient-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 modal-content scale-95">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Edit Patient Details</h2>
            <form id="beds-patient-edit-form">
                <input type="hidden" id="beds-patient-bed-ward-index">
                <input type="hidden" id="beds-patient-bed-index">
                <div class="space-y-4">
                    <div>
                        <label for="beds-patient-name" class="block text-sm font-medium text-gray-700">Patient Name</label>
                        <input type="text" id="beds-patient-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="beds-patient-gender" class="block text-sm font-medium text-gray-700">Gender</label>
                        <select id="beds-patient-gender" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                            <option>Male</option>
                            <option>Female</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="beds-patient-disease" class="block text-sm font-medium text-gray-700">Disease</label>
                        <input type="text" id="beds-patient-disease" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="beds-patient-symptoms" class="block text-sm font-medium text-gray-700">Symptoms</label>
                        <textarea id="beds-patient-symptoms" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm"></textarea>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t flex justify-end space-x-3">
                    <button type="button" id="beds-patient-edit-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md">Cancel</button>
                    <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md">Save Patient Info</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="sched-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden modal-overlay">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-lg p-6 modal-content scale-95">
            <h2 id="sched-modal-title" class="text-2xl font-bold text-gray-800 mb-6">Add New Schedule</h2>
            <form id="sched-form">
                <input type="hidden" id="sched-id">
                <div class="space-y-4">
                    <div>
                        <label for="sched-staffName" class="block text-sm font-medium text-gray-700">Staff Name</label>
                        <input type="text" id="sched-staffName" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="sched-role" class="block text-sm font-medium text-gray-700">Role</label>
                        <input type="text" id="sched-role" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                    </div>
                    <div>
                        <label for="sched-ward" class="block text-sm font-medium text-gray-700">Ward</label>
                        <select id="sched-ward" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required></select>
                    </div>
                    <div>
                        <label for="sched-shift" class="block text-sm font-medium text-gray-700">Shift</label>
                        <select id="sched-shift" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required>
                            <option>Morning (8 AM - 4 PM)</option>
                            <option>Evening (4 PM - 12 AM)</option>
                            <option>Night (12 AM - 8 AM)</option>
                        </select>
                    </div>
                </div>
                <div class="mt-8 pt-6 border-t flex justify-end space-x-3">
                    <button type="button" id="sched-cancel-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-md">Cancel</button>
                    <button type="submit" id="sched-save-btn" class="bg-green-600 text-white font-bold py-2 px-4 rounded-md">Save Schedule</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            /* -------------------- Persistence helpers -------------------- */
            const STORAGE_KEY = 'ward_app_state_v1';
            function saveState() {
                try {
                    const state = { dashboardData, bedsWardsData, schedules };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                } catch (err) {
                    console.warn('Failed to save state', err);
                }
            }
            function loadState() {
                try {
                    const raw = localStorage.getItem(STORAGE_KEY);
                    if (!raw) return;
                    const parsed = JSON.parse(raw);
                    if (parsed.dashboardData) dashboardData = parsed.dashboardData;
                    if (parsed.bedsWardsData) bedsWardsData = parsed.bedsWardsData;
                    if (parsed.schedules) schedules = parsed.schedules;
                } catch (err) {
                    console.warn('Failed to load state', err);
                }
            }

            /* -------------------- Tab handling -------------------- */
            const tabButtons = document.querySelectorAll('.tab-btn');
            const sections = document.querySelectorAll('.tab-section');
            function showTab(name) {
                sections.forEach(s => s.id === 'section-' + name ? s.classList.remove('hidden') : s.classList.add('hidden'));
                tabButtons.forEach(b => b.classList.toggle('bg-blue-600', b.dataset.tab === name));
            }
            // wire sidebar tab buttons
            document.querySelectorAll('[data-tab]').forEach(btn => btn.addEventListener('click', () => showTab(btn.dataset.tab)));
            // default to dashboard tab visible
            showTab('dashboard');

            /* -------------------- Dashboard (metrics & ward overview) -------------------- */
            const dashEditBtn = document.getElementById('dash-edit-btn');
            const dashEditModal = document.getElementById('dash-edit-modal');
            const dashCancelBtn = document.getElementById('dash-cancel-btn');
            const dashEditForm = document.getElementById('dash-edit-form');
            const dashWardsEditor = document.getElementById('dash-wards-editor');
            const dashAddWardBtn = document.getElementById('dash-add-ward-btn');
            const wardOverviewContainer = document.getElementById('ward-overview-container');

            let dashboardData = { wards: [ { id: 1, name: 'General Ward', occupied: 60, total: 70, color: 'bg-blue-600' }, { id: 2, name: 'Intensive Care Unit (ICU)', occupied: 18, total: 20, color: 'bg-red-600' }, { id: 3, name: 'Maternity Ward', occupied: 15, total: 25, color: 'bg-pink-500' } ] };

            function renderMetrics() {
                const totalBeds = dashboardData.wards.reduce((sum, w) => sum + (w.total||0), 0);
                const occupiedBeds = dashboardData.wards.reduce((sum, w) => sum + (w.occupied||0), 0);
                const availableBeds = totalBeds - occupiedBeds;
                const occupancyRate = totalBeds > 0 ? ((occupiedBeds / totalBeds) * 100).toFixed(1) : 0;
                document.querySelector('[data-metric="total"]').textContent = totalBeds;
                document.querySelector('[data-metric="occupied"]').textContent = occupiedBeds;
                document.querySelector('[data-metric="available"]').textContent = availableBeds;
                document.querySelector('[data-metric="rate"]').textContent = `${occupancyRate}%`;
            }

            function renderWardOverview() {
                wardOverviewContainer.innerHTML = '';
                dashboardData.wards.forEach(ward => {
                    const percentage = ward.total > 0 ? (ward.occupied / ward.total) * 100 : 0;
                    const wardHtml = `
                    <div>
                        <div class="flex justify-between mb-1">
                            <span class="text-base font-medium text-gray-700">${ward.name}</span>
                            <span class="text-sm font-medium text-gray-700">${ward.occupied} / ${ward.total}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="${ward.color} h-2.5 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                    </div>`;
                    wardOverviewContainer.insertAdjacentHTML('beforeend', wardHtml);
                });
            }

            function createDashWardEditorRow(ward = {}) {
                const id = ward.id || Date.now();
                const div = document.createElement('div');
                div.className = 'grid grid-cols-5 gap-2 items-center';
                div.dataset.id = id;
                div.innerHTML = `
                    <input type="text" value="${ward.name || ''}" placeholder="Ward Name" class="col-span-2 border-gray-300 rounded-md shadow-sm p-1">
                    <input type="number" value="${ward.occupied || 0}" placeholder="Occupied" class="border-gray-300 rounded-md shadow-sm p-1">
                    <input type="number" value="${ward.total || 0}" placeholder="Total" class="border-gray-300 rounded-md shadow-sm p-1">
                    <button type="button" class="dash-delete-ward-btn bg-red-500 text-white rounded-md py-1 px-2 text-sm">Delete</button>`;
                dashWardsEditor.appendChild(div);
            }

            dashEditBtn.addEventListener('click', () => { dashWardsEditor.innerHTML = ''; dashboardData.wards.forEach(w => createDashWardEditorRow(w)); dashEditModal.classList.remove('hidden'); });
            dashCancelBtn.addEventListener('click', () => dashEditModal.classList.add('hidden'));
            dashAddWardBtn.addEventListener('click', () => createDashWardEditorRow());
            dashWardsEditor.addEventListener('click', e => { if (e.target.classList.contains('dash-delete-ward-btn')) e.target.parentElement.remove(); });
            dashEditForm.addEventListener('submit', e => {
                e.preventDefault();
                const updated = [];
                dashWardsEditor.querySelectorAll('[data-id]').forEach(row => {
                    const ins = row.querySelectorAll('input');
                    updated.push({ id: row.dataset.id, name: ins[0].value, occupied: parseInt(ins[1].value,10) || 0, total: parseInt(ins[2].value,10) || 0, color: 'bg-gray-500' });
                });
                dashboardData.wards = updated;
                // update schedule ward options when wards change
                populateSchedWardOptions();
                renderMetrics(); renderWardOverview();
                saveState();
                dashEditModal.classList.add('hidden');
            });

            /* -------------------- Beds management (namespaced) -------------------- */
            const bedsContainer = document.getElementById('beds-wards-container');
            const bedsEditBtn = document.getElementById('beds-edit-btn');
            const bedsEditModal = document.getElementById('beds-edit-modal');
            const bedsCancelBtn = document.getElementById('beds-cancel-btn');
            const bedsEditForm = document.getElementById('beds-edit-form');
            const bedsWardsEditor = document.getElementById('beds-wards-editor');
            const bedsPatientInfoModal = document.getElementById('beds-patient-info-modal');
            const bedsPatientModalCloseBtn = document.getElementById('beds-patient-modal-close-btn');
            const bedsPatientEditModal = document.getElementById('beds-patient-edit-modal');
            const bedsPatientEditForm = document.getElementById('beds-patient-edit-form');
            const bedsPatientEditCancelBtn = document.getElementById('beds-patient-edit-cancel-btn');

            let bedsWardsData = [
                { name: 'General Ward', beds: [ { id: 'G01', status: 'Occupied', patient: { name: 'Rohan Verma', gender: 'Male', disease: 'Hypertension', symptoms: 'High blood pressure, headaches' } }, { id: 'G02', status: 'Occupied', patient: { name: 'Priya Sharma', gender: 'Female', disease: 'Common Cold', symptoms: 'Cough, sore throat' } }, { id: 'G03', status: 'Available', patient: null }, { id: 'G04', status: 'Occupied', patient: { name: 'Amit Kumar', gender: 'Male', disease: 'Post-operative care', symptoms: 'Pain management' } }, { id: 'G05', status: 'Needs Cleaning', patient: null }, { id: 'G06', status: 'Occupied', patient: { name: 'Sunita Patil', gender: 'Female', disease: 'Diabetes', symptoms: 'Monitoring blood sugar' } }, { id: 'G07', status: 'Available', patient: null }, { id: 'G08', status: 'Occupied', patient: { name: 'Neha Gupta', gender: 'Female', disease: 'Migraine', symptoms: 'Severe headache, nausea' } } ] },
                { name: 'Intensive Care Unit (ICU)', beds: [ { id: 'ICU01', status: 'Occupied', patient: { name: 'Vikram Singh', gender: 'Male', disease: 'Cardiac Arrest', symptoms: 'Critical monitoring' } }, { id: 'ICU02', status: 'Occupied', patient: { name: 'Meena Desai', gender: 'Female', disease: 'Respiratory Failure', symptoms: 'Ventilator support' } }, { id: 'ICU03', status: 'Occupied', patient: { name: 'Anil Kapoor', gender: 'Male', disease: 'Sepsis', symptoms: 'Antibiotic therapy' } }, { id: 'ICU04', status: 'Available', patient: null } ] },
                { name: 'Maternity Ward', beds: [ { id: 'M01', status: 'Available', patient: null }, { id: 'M02', status: 'Occupied', patient: { name: 'Kavita Joshi', gender: 'Female', disease: 'Post-delivery care', symptoms: 'Normal delivery' } }, { id: 'M03', status: 'Needs Cleaning', patient: null }, { id: 'M04', status: 'Occupied', patient: { name: 'Reena Patel', gender: 'Female', disease: 'Pre-eclampsia', symptoms: 'High-risk monitoring' } }, { id: 'M05', status: 'Available', patient: null } ] }
            ];

            function bedsStatusClass(status) { switch (status) { case 'Available': return 'bg-green-500 text-white'; case 'Occupied': return 'bg-red-500 text-white'; case 'Needs Cleaning': return 'bg-yellow-400 text-gray-800'; default: return 'bg-gray-300 text-gray-800'; } }
            function renderBeds() {
                bedsContainer.innerHTML = '';
                bedsWardsData.forEach((ward, wardIndex) => {
                    const bedsHtml = ward.beds.map((bed, bedIndex) => `<div class="bed ${bedsStatusClass(bed.status)} p-2 rounded-md text-center shadow-sm" data-ward-index="${wardIndex}" data-bed-index="${bedIndex}"><span class="font-bold">${bed.id}</span></div>`).join('');
                    const wardHtml = `<div class="bg-white p-6 rounded-lg shadow-md"><h3 class="text-xl font-semibold text-gray-800 mb-4">${ward.name}</h3><div class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-4">${bedsHtml}</div></div>`;
                    bedsContainer.insertAdjacentHTML('beforeend', wardHtml);
                });
                // also update overview samples
                const g = document.getElementById('overview-general'); const i = document.getElementById('overview-icu'); const m = document.getElementById('overview-mat');
                if (g && i && m) {
                    g.innerHTML = ''; i.innerHTML = ''; m.innerHTML = '';
                    bedsWardsData.forEach(w => { const target = w.name.includes('ICU') ? i : w.name.includes('Maternity') ? m : g; w.beds.forEach(b => { const el = document.createElement('div'); el.className = `bed ${bedsStatusClass(b.status)} text-white p-2 rounded-md text-center shadow-sm`; el.innerHTML = `<span class="font-bold">${b.id}</span>`; target.appendChild(el); }); });
                }
            }

            bedsEditBtn.addEventListener('click', () => { bedsWardsEditor.innerHTML = ''; bedsWardsData.forEach((ward, index) => { const sec = document.createElement('div'); sec.innerHTML = `<div class="flex justify-between items-center mb-2 border-b pb-2"><h4 class="text-lg font-semibold text-gray-700">${ward.name}</h4><button type="button" class="beds-add-bed-btn bg-blue-500 text-white text-sm py-1 px-3 rounded-md" data-ward-index="${index}">Add Bed</button></div><div class="space-y-2" data-beds-editor-index="${index}"></div>`; const container = sec.querySelector(`[data-beds-editor-index="${index}"]`); ward.beds.forEach((bed, bedIndex) => container.appendChild(createBedsEditorRow(bed,index,bedIndex))); bedsWardsEditor.appendChild(sec); }); bedsEditModal.classList.remove('hidden'); });
            function createBedsEditorRow(bed, wardIndex, bedIndex) { const div = document.createElement('div'); div.className = 'grid grid-cols-12 gap-2 items-center'; div.dataset.bedId = bed.id; const editPatientBtn = bed.status === 'Occupied' ? `<button type="button" class="beds-edit-patient-btn text-blue-600 hover:underline text-sm" data-ward-index="${wardIndex}" data-bed-index="${bedIndex}">Edit Patient</button>` : ''; div.innerHTML = `<input type="text" value="${bed.id}" class="col-span-3 border-gray-300 rounded-md shadow-sm p-1" placeholder="Bed ID"><select class="col-span-3 border-gray-300 rounded-md shadow-sm p-1"><option ${bed.status==='Available'?'selected':''}>Available</option><option ${bed.status==='Occupied'?'selected':''}>Occupied</option><option ${bed.status==='Needs Cleaning'?'selected':''}>Needs Cleaning</option></select><div class="col-span-4 text-center">${editPatientBtn}</div><button type="button" class="beds-delete-bed-btn col-span-2 bg-red-500 text-white rounded-md py-1 px-2 text-sm">Delete</button>`; return div; }
            bedsWardsEditor.addEventListener('click', e => { if (e.target.classList.contains('beds-add-bed-btn')) { const wardIndex = e.target.dataset.wardIndex; const container = bedsWardsEditor.querySelector(`[data-beds-editor-index="${wardIndex}"]`); container.appendChild(createBedsEditorRow({ id: `NEW-${Date.now()}`, status: 'Available' }, wardIndex, -1)); } if (e.target.classList.contains('beds-delete-bed-btn')) e.target.closest('[data-bed-id]').remove(); if (e.target.classList.contains('beds-edit-patient-btn')) { openBedsPatientEditModal(e.target.dataset.wardIndex, e.target.dataset.bedIndex); } });
            bedsCancelBtn.addEventListener('click', () => bedsEditModal.classList.add('hidden'));
            bedsEditForm.addEventListener('submit', e => { e.preventDefault(); const newData = []; const sections = bedsWardsEditor.querySelectorAll('[data-beds-editor-index]'); sections.forEach((section, idx) => { const rows = section.querySelectorAll('[data-bed-id]'); const newBeds = []; rows.forEach(r => { const inputs = r.querySelectorAll('input, select'); const old = bedsWardsData[idx].beds.find(b => b.id == r.dataset.bedId); const status = inputs[1].value; let patient = old ? old.patient : null; if (status === 'Occupied' && !patient) patient = { name: 'New Patient', gender: 'N/A', disease: 'N/A', symptoms: 'N/A' }; if (status !== 'Occupied') patient = null; newBeds.push({ id: inputs[0].value, status, patient }); }); newData.push({ ...bedsWardsData[idx], beds: newBeds }); }); bedsWardsData = newData; renderBeds(); saveState(); bedsEditModal.classList.add('hidden'); });
            function openBedsPatientInfo(patient) { const content = document.getElementById('beds-patient-info-content'); content.innerHTML = `<div><p><strong>Name:</strong> ${patient.name}</p></div><div><p><strong>Gender:</strong> ${patient.gender}</p></div><div><p><strong>Disease:</strong> ${patient.disease}</p></div><div><p><strong>Symptoms:</strong> ${patient.symptoms}</p></div>`; bedsPatientInfoModal.classList.remove('hidden'); }
            function closeBedsPatientInfo() { bedsPatientInfoModal.classList.add('hidden'); }
            bedsPatientModalCloseBtn.addEventListener('click', closeBedsPatientInfo);
            function openBedsPatientEditModal(wardIndex, bedIndex) { const patient = bedsWardsData[wardIndex].beds[bedIndex].patient || { name:'', gender:'Male', disease:'', symptoms:'' }; document.getElementById('beds-patient-bed-ward-index').value = wardIndex; document.getElementById('beds-patient-bed-index').value = bedIndex; document.getElementById('beds-patient-name').value = patient.name; document.getElementById('beds-patient-gender').value = patient.gender; document.getElementById('beds-patient-disease').value = patient.disease; document.getElementById('beds-patient-symptoms').value = patient.symptoms; bedsPatientEditModal.classList.remove('hidden'); }
            bedsPatientEditCancelBtn.addEventListener('click', () => bedsPatientEditModal.classList.add('hidden'));
            bedsPatientEditForm.addEventListener('submit', e => { e.preventDefault(); const wi = document.getElementById('beds-patient-bed-ward-index').value; const bi = document.getElementById('beds-patient-bed-index').value; bedsWardsData[wi].beds[bi].patient = { name: document.getElementById('beds-patient-name').value, gender: document.getElementById('beds-patient-gender').value, disease: document.getElementById('beds-patient-disease').value, symptoms: document.getElementById('beds-patient-symptoms').value }; bedsPatientEditModal.classList.add('hidden'); renderBeds(); saveState(); });
            // click on bed to view patient info
            bedsContainer.addEventListener('click', e => { const bedEl = e.target.closest('.bed'); if (!bedEl) return; const wi = bedEl.dataset.wardIndex; const bi = bedEl.dataset.bedIndex; const bed = bedsWardsData[wi].beds[bi]; if (bed.status === 'Occupied' && bed.patient) openBedsPatientInfo(bed.patient); });

            /* -------------------- Schedule (namespaced) -------------------- */
            const schedTableBody = document.getElementById('sched-table-body');
            const schedDatePicker = document.getElementById('sched-date-picker');
            const schedAddBtn = document.getElementById('sched-add-btn');
            const schedModal = document.getElementById('sched-modal');
            const schedCancelBtn = document.getElementById('sched-cancel-btn');
            const schedForm = document.getElementById('sched-form');
            const schedWardSelect = document.getElementById('sched-ward');

            let schedWards = dashboardData.wards.map(w => w.name);
            let schedules = { '2025-08-27': [ { id: 1, staffName: 'Aarav Patel', role: 'Head Nurse', ward: 'General Ward', shift: 'Morning (8 AM - 4 PM)' }, { id: 2, staffName: 'Bina Rai', role: 'Nurse', ward: 'ICU', shift: 'Night (12 AM - 8 AM)' }, { id: 3, staffName: 'Chetan Joshi', role: 'Nurse', ward: 'Maternity Ward', shift: 'Evening (4 PM - 12 AM)' } ] };
            let editingScheduleId = null;
            function formatDate(d){ return d.toISOString().split('T')[0]; }
            function populateSchedWardOptions(){ schedWards = dashboardData.wards.map(w => w.name); schedWardSelect.innerHTML = schedWards.map(w=>`<option>${w}</option>`).join(''); }
            function renderSchedule(date){ const daily = schedules[date]||[]; schedTableBody.innerHTML=''; if(daily.length===0){ schedTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 py-4">No schedule for this day.</td></tr>`; return; } daily.forEach(s=>{ const row = `<tr class="hover:bg-gray-50"><td class="py-2 px-4 border-b">${s.staffName}</td><td class="py-2 px-4 border-b">${s.role}</td><td class="py-2 px-4 border-b">${s.ward}</td><td class="py-2 px-4 border-b">${s.shift}</td><td class="py-2 px-4 border-b space-x-2"><button class="sched-edit-btn text-blue-600 hover:underline" data-id="${s.id}">Edit</button><button class="sched-delete-btn text-red-600 hover:underline" data-id="${s.id}">Delete</button></td></tr>`; schedTableBody.insertAdjacentHTML('beforeend', row); }); }
            function openSchedModal(scheduleToEdit=null){ schedForm.reset(); if(scheduleToEdit){ document.getElementById('sched-modal-title').textContent='Edit Schedule'; document.getElementById('sched-save-btn').textContent='Update Schedule'; editingScheduleId = scheduleToEdit.id; document.getElementById('sched-staffName').value = scheduleToEdit.staffName; document.getElementById('sched-role').value = scheduleToEdit.role; document.getElementById('sched-ward').value = scheduleToEdit.ward; document.getElementById('sched-shift').value = scheduleToEdit.shift; } else { document.getElementById('sched-modal-title').textContent='Add New Schedule'; document.getElementById('sched-save-btn').textContent='Save Schedule'; editingScheduleId = null; } schedModal.classList.remove('hidden'); }
            schedAddBtn.addEventListener('click', ()=> openSchedModal()); schedCancelBtn.addEventListener('click', ()=> schedModal.classList.add('hidden'));
            schedTableBody.addEventListener('click', e => { const id = parseInt(e.target.dataset.id,10); if(!id) return; const selectedDate = schedDatePicker.value; const daily = schedules[selectedDate]||[]; if(e.target.classList.contains('sched-edit-btn')){ const sched = daily.find(s=>s.id===id); openSchedModal(sched); } if(e.target.classList.contains('sched-delete-btn')){ if(confirm('Are you sure you want to delete this schedule entry?')){ schedules[selectedDate] = daily.filter(s=>s.id!==id); saveState(); renderSchedule(selectedDate); } } });
            schedForm.addEventListener('submit', e=>{ e.preventDefault(); const selectedDate = schedDatePicker.value; if(!schedules[selectedDate]) schedules[selectedDate]=[]; const data = { id: editingScheduleId||Date.now(), staffName: document.getElementById('sched-staffName').value, role: document.getElementById('sched-role').value, ward: document.getElementById('sched-ward').value, shift: document.getElementById('sched-shift').value }; if(editingScheduleId){ const idx = schedules[selectedDate].findIndex(s=>s.id===editingScheduleId); schedules[selectedDate][idx]=data; } else schedules[selectedDate].push(data); saveState(); renderSchedule(selectedDate); schedModal.classList.add('hidden'); });
            schedDatePicker.addEventListener('change', ()=> { const d = new Date(schedDatePicker.value); document.getElementById('sched-title').textContent = `Staff Schedule - ${d.toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'})}`; renderSchedule(schedDatePicker.value); });

            /* -------------------- Initial load -------------------- */
            function initializeAll(){ loadState(); renderMetrics(); renderWardOverview(); renderBeds(); populateSchedWardOptions(); const today = new Date(); schedDatePicker.value = formatDate(today); schedDatePicker.dispatchEvent(new Event('change')); }
            initializeAll();
        });
    </script>

</body>

</html>